function change_groups_tab(){$('[name="groups-tab"]').click(function(e){e.preventDefault();update_admin_window_content("theamus-groups",$(this).attr("data-file"));change_admin_window_title("theamus-groups",$(this).attr("data-title"))});return}function define_homepage(){if($("#type").val()==="nooverride")var e="false";else{var t=$("#type").val(),n=$("#"+t+" :input"),e='{t:homepage;type="'+t+'";';if(t==="page")e+='id="'+n[0].value+'";';if(t==="custom")e+='url="'+n[0].value.replace(/\./g,"{p}").replace(/\-/g,"{d}").replace(/\//g,"{fs}")+'";';if(t==="feature"){e+='id="'+n[0].value+'";';e+='file="'+n[1].value+'";'}e+=":}"}return e}function load_groups_list(){$("#groups-list").html(Theamus.Notify("spinner","Loading..."));Theamus.Ajax.run({url:Theamus.base_url+"/groups/groups-list/",result:"groups-list",type:"include",after:function(){list_listeners()}});return}function groups_next_page(e){$("#groups-list").html(Theamus.Notify("spinner","Loading..."));var t=$("#search").val()===undefined?"":$("#search").val();Theamus.Ajax.run({url:Theamus.base_url+"/groups/groups-list&search="+t+"&page="+e,result:"groups-list",type:"include",after:function(){list_listeners()}});return false}function list_listeners(){$('[name="edit-group-link"]').click(function(e){e.preventDefault();change_admin_window_title("theamus-groups","Edit Group");update_admin_window_content("theamus-groups","/groups/edit?id="+$(this).data("id"))});$('[name="remove-group-link"]').click(function(e){e.preventDefault();change_admin_window_title("theamus-groups","Edit Group");update_admin_window_content("theamus-groups","/groups/remove?id="+$(this).data("id"))});return}function search_groups(){$("#search-groups-form").submit(function(e){e.preventDefault();groups_next_page(1)});return}function create_group(){$("#create-group-form").submit(function(e){e.preventDefault();$("#group-result").html(Theamus.Notify("spinner","Creating..."));$("#theamus-groups").scrollTop(0);$(this).find('button[type="submit"]').attr("disabled","disabled");Theamus.Ajax.api({type:"post",url:Theamus.base_url+"/groups/",method:["Groups","create_group"],data:{form:this},success:function(e){if(e.error.status===1){$("#create-group-form").find('button[type="submit"]').removeAttr("disabled");$("#group-result").html(Theamus.Notify("danger",e.error.message))}else{$("#group-result").html(Theamus.Notify("success","Group created successfully."));setTimeout(function(){change_admin_window_title("theamus-groups","Theamus Groups");update_admin_window_content("theamus-groups","/groups/")},2500)}}})});return}function edit_group(){$('[name="type-link"]').click(function(e){e.preventDefault();var t=$("#type").val();$("#type").val($(this).attr("data-type"));$("#"+t).hide();$("#"+$(this).attr("data-type")).show();resize_admin_window()});$("#featurename").change(function(){Theamus.Ajax.api({type:"get",url:Theamus.base_url+"/groups/",method:["Groups","get_feature_file_options"],data:{custom:{feature_folder:$(this).find(":selected").attr("data-alias")}},success:function(e){if(e.error.status===1){$("#feature-file-list").html("<option>Failed to get feature files.</option>")}else{$("#feature-file-list").html(e.response.data)}}})});$("#save-group-form").submit(function(e){e.preventDefault();$("#group-result").show().html(Theamus.Notify("spinner","Saving..."));$("#theamus-groups").scrollTop(0);$(this).find('button[type="submit"]').attr("disabled","disabled");Theamus.Ajax.api({type:"post",url:Theamus.base_url+"/groups/",method:["Groups","save_group"],data:{form:this,custom:{homepage:define_homepage()}},success:function(e){if(e.error.status===1){$("#group-result").html(Theamus.Notify("danger",e.error.message))}else{$("#group-result").html(Theamus.Notify("success","Group saved."));setTimeout(function(){$("#group-result").html("").hide()},2500)}$("#save-group-form").find('button[type="submit"]').removeAttr("disabled")}})});return}function remove_group(){$("#remove-group-form").submit(function(e){e.preventDefault();$("#remove-result").show().html(Theamus.Notify("spinner","Removing..."));$("#theamus-groups").scrollTop(0);$(this).find('button[type="submit"]').attr("disabled","disabled");Theamus.Ajax.api({type:"post",url:Theamus.base_url+"/groups/",method:["Groups","remove_group"],data:{form:this},success:function(e){if(e.error.status===1){$("#remove-result").html(Theamus.Notify("danger",e.error.message));$("#remove-group-form").find('button[type="submit"]').removeAttr("disabled")}else{$("#remove-result").html(Theamus.Notify("success","Group removed."));setTimeout(function(){change_admin_window_title("theamus-groups","Theamus Groups");update_admin_window_content("theamus-groups","/groups/")},2e3)}}})});return}