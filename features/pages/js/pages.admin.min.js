function change_pages_tab(){$('[name="pages-tab"]').click(function(e){e.preventDefault(),update_admin_window_content("theamus-pages",$(this).attr("data-file")),change_admin_window_title("theamus-pages",$(this).attr("data-title"))})}function get_pages(e){var a=void 0===e||e%1!==0?1:e,t=$("#pages-search-query").length>0?$("#pages-search-query").val():"";return $("#pages_list").html(alert_notify("spinner","Loading...")),Theamus.Ajax.run({url:Theamus.base_url+"/pages/pages-list/&search="+t+"&page="+a,result:"pages-list",type:"include",after:function(){list_listeners()}}),!1}function list_listeners(){$('[name="edit-page-link"]').click(function(e){e.preventDefault(),change_admin_window_title("theamus-pages","Edit Page"),update_admin_window_content("theamus-pages","/pages/edit?id="+$(this).data("id"))}),$('[name="remove-page-link"]').click(function(e){e.preventDefault(),change_admin_window_title("theamus-pages","Remove Page"),update_admin_window_content("theamus-pages","/pages/remove?id="+$(this).data("id"))})}function search(){$("#pages-search-form").submit(function(e){e.preventDefault(),get_pages(1)})}function add_new_link(){var e=$("#link-area").children().length+1,a="";e>1&&(a="<div class='form-control-static'><a href='#' data-link='"+e+"' name='remove-link'>Remove</a></div>");var t="<div class='link_row' id='link_row"+e+"'><div class='form-group'><div class='col-12'><input type='text' class='form-control' autocomplete='off' placeholder='Link Text' id='linktext-"+e+"' /><input type='text' class='form-control' autocomplete='off' placeholder='Link Path' id='linkpath-"+e+"' /></div></div>"+a+"</div>";return $("#link-area").append(t),!1}function aggregate_navigation(){for(var e,a=$("#link-area").children(),t=new Array,n=1;n<=a.length;n++)""!==$("#linktext-"+n).val()&&t.push($("#linktext-"+n).val()+"::"+$("#linkpath-"+n).val());e=t.join(","),$("#navigation").val(e)}function remove_link(){$('[name="remove-link"]').click(function(e){e.preventDefault(),$("#link_row"+$(this).attr("data-link")).remove()})}function load_layout_navigation(){var e=$("[name='layout']").children(),a=$("[name='layout']"),t=!1;if(a.length>0){a=a[0].value;for(var n=0;n<e.length;n++)e[n].value===a&&"true"===e[n].dataset.nav&&(t=!0);t===!1?($("#nav-links").hide(),$("#link-area").html(""),$("#navigation")[0].value):($("#nav-links").show(),0===$("#link-area").children().length&&add_new_link())}}function create_page(){$('[name="layout"]').change(function(){load_layout_navigation()}),$("#add-new-link").click(function(e){e.preventDefault(),add_new_link(),remove_link()}),$("#create-page-form").submit(function(e){e.preventDefault(),generate_permalink(),aggregate_navigation(),$("#page-result").html(Theamus.Notify("spinner","Creating...")),$("#theamus-pages").scrollTop(0),$(this).find('button[type="submit"]').attr("disabled","disabled"),Theamus.Ajax.api({type:"post",url:Theamus.base_url+"/pages/",method:["Pages","create_page"],data:{form:this},success:function(e){1===e.error.status?($("#page-result").html(Theamus.Notify("danger",e.error.message)),$("#create-page-form").find('button[type="submit"]').removeAttr("disabled")):($("#page-result").html(Theamus.Notify("success","Page created successfully.")),setTimeout(function(){update_admin_window_content("theamus-pages","/pages/"),change_admin_window_title("theamus-pages","Theamus Pages")},1500))}})})}function edit_page(){$('[name="layout"]').change(function(){load_layout_navigation()}),$("#add-new-link").click(function(e){e.preventDefault(),add_new_link(),remove_link()}),$("#save-page-form").submit(function(e){e.preventDefault(),generate_permalink(),aggregate_navigation(),$("#page-result").html(Theamus.Notify("spinner","Saving...")),$("#theamus-pages").scrollTop(0),$(this).find('button[type="submit"]').attr("disabled","disabled"),Theamus.Ajax.api({type:"post",url:Theamus.base_url+"/pages/",method:["Pages","save_page"],data:{form:this},success:function(e){$("#page-result").show(),1===e.error.status?$("#page-result").html(Theamus.Notify("danger",e.error.message)):($("#page-result").html(Theamus.Notify("success","Page saved.")),setTimeout(function(){$("#page-result").html("").hide()},2e3)),$("#save-page-form").find('button[type="submit"]').removeAttr("disabled")}})})}function remove_page(){$("#remove-page-form").submit(function(e){e.preventDefault(),$("#remove-result").html(Theamus.Notify("spinner","Removing...")),$(this).find('button[type="submit"]').attr("disabled","disabled"),Theamus.Ajax.api({type:"post",url:Theamus.base_url+"/pages/",method:["Pages","remove_page"],data:{form:this},success:function(e){1===e.error.status?$("#remove-result").html(Theamus.Notify("danger",e.error.message)):($("#remove-result").html(Theamus.Notify("success","Page removed.")),setTimeout(function(){update_admin_window_content("theamus-pages","/pages/"),change_admin_window_title("theamus-pages","Theamus Pages")},1500))}})})}function generate_permalink(){var e=document.getElementById("title"),a=document.getElementById("alias");e.addEventListener("blur",function(){var e=this.value.replace(/ /g,"-").replace(/[^A-Za-z0-9-]/g,"").toLowerCase();""===a.value&&(a.value=e)}),a.addEventListener("blur",function(){this.value=this.value.replace(/ /g,"-").replace(/[^A-Za-z0-9-]/g,"").toLowerCase()})}