function remove_file(e){for(var a=new Array,i=0;i<files.length;i++)i!=e&&a.push(files[i]);return files=a,files.length>0?show_files():show_dnd(),!1}function handle_single_file(){for(var e=$("#tempfile_input")[0],a=new Array,i=0;i<files.length;i++)a.push(files[i]);files=a,$(e).replaceWith($(e).clone(!0)),show_files()}function show_dnd(){$("#dnd_area").show(),$("#media_add-list").hide(),$("#media_add-list").html(""),$("#dnd_alt-add").html("or select files to upload...")}function show_files(){$("#dnd_alt-add").html("add more files...");for(var e="",a=0;a<files.length;a++)e+="<div class='media_add-fileitem' id='mfi-"+a+"'>",e+="<div id='uprog-"+a+"' class='media_upload-prog'><span id='uper-"+a+"' class='media_upload-perc'></span></div>",e+="<div class='media_add-fileinfo'>",e+="<a href='javascript:void(0);' class='media_remove-fileitem' onclick=\"return remove_file('"+a+"');\">X</a>",e+="<span class='media_add-filename'>"+files[a].name+"</span>",e+="<span class='media_add-filesize'>"+files[a].size+" kb</span>",e+="<div class='media_result' id='media_result-"+a+"'></div>",e+="</div></div>";$("#dnd_area").hide(),$("#media_add-list").show(),$("#media_add-list").html(e)}function upload_media(e){e<files.length&&files.length>0?($("#theamus-media").animate({scrollTop:parseInt($("#mfi-"+e)[0].offsetTop)-58},"slow"),Theamus.Ajax.api({type:"post",url:Theamus.base_url+"/media/",method:["Media","upload_media"],upload:{files:[files[e]],during:function(a){$("#uprog-"+e).css("width",6*a.percent_completed),$("#uper-"+e).html(a.percentage)}},success:function(a){if(1===a.error.status)$("#media_result-"+e).html(a.error.message);else{var i=["Success!","Completed!","Uploaded!","It worked!"];$("#media_result-"+e).html(i[Math.floor(Math.random()*i.length)]),setTimeout(function(){upload_media(e+1)},500)}}})):(update_admin_window_content("theamus-media","/media/"),change_admin_window_title("theamus-media","Theamus Media"))}function dnd_listen(){var e=$("#dnd_area");e.on("dragenter",function(e){e.stopPropagation(),e.preventDefault(),$(this).addClass("dnd_area-hover")}),e.on("dragleave",function(e){e.stopPropagation(),e.preventDefault(),$(this).removeClass("dnd_area-hover")}),e.on("dragover",function(e){e.stopPropagation(),e.preventDefault()}),e.on("drop",function(e){e.preventDefault(),files=e.originalEvent.dataTransfer.files,$(this).removeClass("dnd_area-hover"),show_files()}),$("#dnd_alt-add").click(function(e){e.preventDefault(),$("#tempfile_input").click()}),$("#tempfile_input").change(function(){handle_single_file()}),$("#upload_media").click(function(e){e.preventDefault(),upload_media(0),$(".media_remove-fileitem").hide(),$(".media_dnd-alt").hide(),$("#upload_media").prop("disabled",!0),$("#media_add-close").val("Close")}),$("#media_add-close").click(function(e){e.preventDefault(),load_media_list(),close_add_media()})}var files=new Array;