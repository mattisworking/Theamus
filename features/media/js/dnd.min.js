function remove_file(e){var t=new Array;for(var n=0;n<files.length;n++){if(n!=e){t.push(files[n])}}files=t;if(files.length>0){show_files()}else{show_dnd()}return false}function handle_single_file(){var e=$("#tempfile_input")[0];var t=new Array;for(var n=0;n<files.length;n++){t.push(files[n])}t.push(e.files[0]);files=t;$(e).replaceWith($(e).clone(true));show_files()}function show_dnd(){$("#dnd_area").show();$("#media_add-list").hide();$("#media_add-list").html("");$("#dnd_alt-add").html("or select files to upload...")}function show_files(){$("#dnd_alt-add").html("add more files...");var e="";for(var t=0;t<files.length;t++){e+="<div class='media_add-fileitem' id='mfi-"+t+"'>";e+="<div id='uprog-"+t+"' class='media_upload-prog'>"+"<span id='uper-"+t+"' class='media_upload-perc'></span></div>";e+="<div class='media_add-fileinfo'>";e+="<a href='javascript:void(0);' class='media_remove-fileitem' onclick=\"return remove_file('"+t+"');\">X</a>";e+="<span class='media_add-filename'>"+files[t]["name"]+"</span>";e+="<span class='media_add-filesize'>"+files[t]["size"]+" kb</span>";e+="<div class='media_result' id='media_result-"+t+"'></div>";e+="</div></div>"}$("#dnd_area").hide();$("#media_add-list").show();$("#media_add-list").html(e)}function upload_media(e){if(e<files.length&&files.length>0){$("#theamus-media").animate({scrollTop:parseInt($("#mfi-"+e)[0].offsetTop)-58},"slow");Theamus.Ajax.api({type:"post",url:Theamus.base_url+"/media/",method:["Media","upload_media"],upload:{files:[files[e]],during:function(t){$("#uprog-"+e).css("width",t.percent_completed*6);$("#uper-"+e).html(t.percentage)}},success:function(t){if(t.error.status===1){$("#media_result-"+e).html(t.error.message)}else{var n=["Success!","Completed!","Uploaded!","It worked!"];$("#media_result-"+e).html(n[Math.floor(Math.random()*n.length)]);setTimeout(function(){upload_media(e+1)},500)}}})}else{update_admin_window_content("theamus-media","media/");change_admin_window_title("theamus-media","Theamus Media")}}function dnd_listen(){var e=$("#dnd_area");e.on("dragenter",function(e){e.stopPropagation();e.preventDefault();$(this).addClass("dnd_area-hover")});e.on("dragleave",function(e){e.stopPropagation();e.preventDefault();$(this).removeClass("dnd_area-hover")});e.on("dragover",function(e){e.stopPropagation();e.preventDefault()});e.on("drop",function(e){e.preventDefault();files=e.originalEvent.dataTransfer.files;$(this).removeClass("dnd_area-hover");show_files()});$("#dnd_alt-add").click(function(e){e.preventDefault();$("#tempfile_input").click()});$("#tempfile_input").change(function(e){handle_single_file()});$("#upload_media").click(function(e){e.preventDefault();upload_media(0);$(".media_remove-fileitem").hide();$(".media_dnd-alt").hide();$("#upload_media").prop("disabled",true);$("#media_add-close").val("Close")});$("#media_add-close").click(function(e){e.preventDefault();load_media_list();close_add_media()})}var files=new Array