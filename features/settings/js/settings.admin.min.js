function change_settings_tab(){$('[name="settings-tab"]').click(function(e){e.preventDefault();update_admin_window_content("theamus-settings",$(this).attr("data-file"));change_admin_window_title("theamus-settings",$(this).attr("data-title"))})}function change_path(e){$("#"+$("#type").val()+"-wrapper").hide();$("#type").val(e);$("#"+e+"-wrapper").show();show_appropriate_type_messages();resize_admin_window()}function show_appropriate_type_messages(){var e=$("#type").val();if(e==="custom"&&$("#reqlogin")[0].checked){$("#custom-wrapper").hide();$("#no-custom").show()}else if(e==="session"&&$("#reqlogin")[0].checked){$("#session-wrapper").hide();$("#no-session").show()}else{$("#no-session").hide()}if(e==="session"&&$("#setting-session").val()===""){$("#session-wrapper").show();$("#unsetsession").hide()}if(e==="session"&&$("#setting-session").val()==="true"){$("#session-wrapper").hide();$("#unsetsession").show()}if(e==="require-login"&&($("#setting-session").val()===""||$("#setting-session").val()==="false")){$("#require-login-wrapper").show();$("#unsetsession").hide()}else if(e==="require-login"&&($("#setting-session").val()==="in"||$("#setting-session").val()==="out")){$("#require-login-wrapper").hide();$("#unsetsession").show()}}function compile_home(){var e=$("#type").val(),t=$("#"+e+"-wrapper :input"),n,r="{t:homepage;";if($("#setting-session").val()==="true"){r+='type="session";';e="session"}else if($("#reqlogin")[0].checked){r+='type="require-login";';n="require-login"}else{r+='type="'+e+'";';n=e}if($("#reqlogin")[0].checked&&e==="session"||e==="require-login"){r+='after-type="page";id="1"'}if(e==="page"){if(n==="require-login")r+='after-type="page";';r+='id="'+t[0].value+'";'}if(e==="feature"){if(n==="require-login")r+='after-type="feature";';r+='id="'+t[0].value+'";file="'+t[1].value+'";'}if(e==="custom")r+='url="'+t[0].value+'"';if(e==="session")r+=$("#in").val()+$("#out").val();r+=":}";var i=document.createElement("input");i.setAttribute("type","hidden");i.setAttribute("name","home-page");i.value=r;return i}function load_feature_files_select(){Theamus.Ajax.api({type:"get",url:Theamus.base_url+"/settings/",method:["Settings","get_feature_files_select"],data:{custom:{feature:$("#features-select").val()}},success:function(e){if(e.error.status===1){$("#feature-files-select").html("<option>"+e.error.message+"</option>")}else{$("#feature-files-select").html(e.response.data)}}})}function set_session_page(e){$("#session-notify").show();$("#setting-session").val(e);$("#setsesstype").text(e);$("#sessSave")[0].setAttribute("onclick",'save_session("'+e+'")');change_path("page")}function cancel_session_set(e){$("#session-notify").hide();var e=e!==undefined?e:"false";$("#setting-session")[0].value=e}function save_session(e){var t=$("#type").val(),n=$("#"+t+"-wrapper :input"),r=e==="in"?"after":"before";if(t!=="session"&&t!=="login"){var i=r+'-type="'+t+'";';if(t==="page")i+=r+'-id="'+n[0].value+'";';if(t==="feature"){i+=r+'-id="'+n[0].value+'";';i+=r+'-file="'+n[1].value+'";'}if(t==="custom")i+=r+'-url="'+n[0].value+'";';$("#"+e).val(i);if(e==="in"){cancel_session_set();set_session_page("out")}else{cancel_session_set("true");$("#sessionsAreSet").show()}}}function reset_session(){$("#setting-session").val("");$("#in").val("");$("#out").val("");change_path("session");cancel_session_set();$("#sessionsAreSet").hide();return false}function customize(){$('[name="type"]').click(function(e){e.preventDefault();change_path($(this).attr("data-for"))});$("#features-select").change(function(){load_feature_files_select()});$("#reqlogin").change(function(){if(this.checked){$("#login-notify").show();$("#required-login").val("true")}else{$("#login-notify").hide();$("#required-login").val("false")}});$("#set-sessions").click(function(e){e.preventDefault();set_session_page("in")});$("[name='reset-sessions']").click(function(e){e.preventDefault();reset_session()});$("#cancel-sessions").click(function(e){e.preventDefault();cancel_session_set()});$("#customize-settings-form").submit(function(e){e.preventDefault();$("#customize-result").html(Theamus.Notify("spinner","Saving..."));$("#theamus-settings").scrollTop(0);$(this).find('button[type="submit"]').attr("disbaled","disabled");$(this).append(compile_home());Theamus.Ajax.api({type:"post",url:Theamus.base_url+"/settings/",method:["Settings","save_customization"],data:{form:this},success:function(e){$("#customize-result").show();if(e.error.status===1){$("#customize-result").html(Theamus.Notify("danger",e.error.message))}else{$("#customize-result").html(Theamus.Notify("success","Saved."));setTimeout(function(){$("#customize-result").html("").hide()},2e3)}$("#customize-settings-form").find('button[type="submit"]').removeAttr("disabled")}})});return}function settings(){$("#config-email").change(function(){this.checked?$("#email-container").show():$("#email-container").hide();resize_admin_window()});$("#edit-settings-form").submit(function(e){e.preventDefault();$("#settings-result").html(Theamus.Notify("spinner","Saving..."));$("#theamus-settings").scrollTop(0);$(this).find('button[type="submit"]').attr("disabled","disabled");Theamus.Ajax.api({type:"post",url:Theamus.base_url+"/settings/",method:["Settings","save_settings"],data:{form:this},success:function(e){$("#settings-result").show();if(e.error.status===1){$("#settings-result").html(Theamus.Notify("danger",e.error.message))}else{$("#settings-result").html(Theamus.Notify("success","Saved."));setTimeout(function(){$("#customize-result").html("").hide()},2e3)}$("#edit-settings-form").find('button[type="submit"]').removeAttr("disabled")}})});$("#update").click(function(){update_admin_window_content("theamus-settings","/settings/update-check/");change_admin_window_title("theamus-settings","Theamus Auto Updater")});return}function update_check(){$("#checker-wrapper").html(Theamus.Notify("spinner","Checking for updates..."));Theamus.Ajax.api({type:"post",url:Theamus.base_url+"/settings/",method:["Settings","get_update_info"],success:function(e){if(e.error.status===1){$("#checker-wrapper").html(Theamus.Notify("danger",e.error.message))}else if(e.response.data.old_versions.indexOf($("#current_version").val())!==-1){var t='<button class="btn btn-primary" id="settings_update-link">Update to the latest version of Theamus</button><hr class="form-split">';$("#checker-wrapper").html('<div class="col-12">'+t+e.response.data.notes+"</div>");$("#settings_update-link").click(function(e){e.preventDefault();$("#auto-update-result").html(Theamus.Notify("spinner","Updating..."));setTimeout(function(){Theamus.Ajax.api({type:"get",url:Theamus.base_url+"/settings/",method:["Settings","auto_update"],success:function(e){if(e.error.status===1){$("#auto-update-result").html(Theamus.Notify("danger",e.error.message))}else{$("#auto-update-result").html(Theamus.Notify("success",'Everything went smoothly.  In order for things to take effect, you need to <a href="./">refresh the page</a>.'))}}})},500)})}else{$("#checker-wrapper").html(Theamus.Notify("info","No updates are available."))}}});return}function settings_manual_update(){$("#settings_update-form").submit(function(e){e.preventDefault();$("#settings_update-result").show().html(Theamus.Notify("spinner","Updating..."));$("#theamus-settings").scrollTop(0);$(this).find('button[type="submit"]').attr("disabled","disabled");Theamus.Ajax.api({type:"post",url:Theamus.base_url+"/settings/",method:["Settings","manual_update"],data:{form:this},success:function(e){if(e.error.status===1){$("#settings_update-result").html(Theamus.Notify("danger",e.error.message))}else{$("#settings_update-result").html(Theamus.Notify("success",'Everything went smoothly.  In order for things to take effect, you need to <a href="./">refresh the page</a>.'))}$("#settings_update-form").find('button[type="submit"]').removeAttr("disabled")}})})}