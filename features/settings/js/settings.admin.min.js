function change_settings_tab(){$('[name="settings-tab"]').click(function(e){e.preventDefault(),update_admin_window_content("theamus-settings",$(this).attr("data-file")),change_admin_window_title("theamus-settings",$(this).attr("data-title"))})}function change_path(e){$("#"+$("#type").val()+"-wrapper").hide(),$("#type").val(e),$("#"+e+"-wrapper").show(),show_appropriate_type_messages(),resize_admin_window()}function show_appropriate_type_messages(){var e=$("#type").val();"custom"===e&&$("#reqlogin")[0].checked?($("#custom-wrapper").hide(),$("#no-custom").show()):"session"===e&&$("#reqlogin")[0].checked?($("#session-wrapper").hide(),$("#no-session").show()):$("#no-session").hide(),"session"===e&&""===$("#setting-session").val()&&($("#session-wrapper").show(),$("#unsetsession").hide()),"session"===e&&"true"===$("#setting-session").val()&&($("#session-wrapper").hide(),$("#unsetsession").show()),"require-login"!==e||""!==$("#setting-session").val()&&"false"!==$("#setting-session").val()?"require-login"!==e||"in"!==$("#setting-session").val()&&"out"!==$("#setting-session").val()||($("#require-login-wrapper").hide(),$("#unsetsession").show()):($("#require-login-wrapper").show(),$("#unsetsession").hide())}function compile_home(){var e,t=$("#type").val(),s=$("#"+t+"-wrapper :input"),i="{t:homepage;";"true"===$("#setting-session").val()?(i+='type="session";',t="session"):$("#reqlogin")[0].checked?(i+='type="require-login";',e="require-login"):(i+='type="'+t+'";',e=t),($("#reqlogin")[0].checked&&"session"===t||"require-login"===t)&&(i+='after-type="page";id="1"'),"page"===t&&("require-login"===e&&(i+='after-type="page";'),i+='id="'+s[0].value+'";'),"feature"===t&&("require-login"===e&&(i+='after-type="feature";'),i+='id="'+s[0].value+'";file="'+s[1].value+'";'),"custom"===t&&(i+='url="'+s[0].value+'"'),"session"===t&&(i+=$("#in").val()+$("#out").val()),i+=":}";var n=document.createElement("input");return n.setAttribute("type","hidden"),n.setAttribute("name","home-page"),n.value=i,n}function load_feature_files_select(){Theamus.Ajax.api({type:"get",url:Theamus.base_url+"/settings/",method:["Settings","get_feature_files_select"],data:{custom:{feature:$("#features-select").val()}},success:function(e){$("#feature-files-select").html(1===e.error.status?"<option>"+e.error.message+"</option>":e.response.data)}})}function set_session_page(e){$("#session-notify").show(),$("#setting-session").val(e),$("#setsesstype").text(e),$("#sessSave")[0].setAttribute("onclick",'save_session("'+e+'")'),change_path("page")}function cancel_session_set(e){$("#session-notify").hide();var e=void 0!==e?e:"false";$("#setting-session")[0].value=e}function save_session(e){var t=$("#type").val(),s=$("#"+t+"-wrapper :input"),i="in"===e?"after":"before";if("session"!==t&&"login"!==t){var n=i+'-type="'+t+'";';"page"===t&&(n+=i+'-id="'+s[0].value+'";'),"feature"===t&&(n+=i+'-id="'+s[0].value+'";',n+=i+'-file="'+s[1].value+'";'),"custom"===t&&(n+=i+'-url="'+s[0].value+'";'),$("#"+e).val(n),"in"===e?(cancel_session_set(),set_session_page("out")):(cancel_session_set("true"),$("#sessionsAreSet").show())}}function reset_session(){return $("#setting-session").val(""),$("#in").val(""),$("#out").val(""),change_path("session"),cancel_session_set(),$("#sessionsAreSet").hide(),!1}function customize(){$('[name="type"]').click(function(e){e.preventDefault(),change_path($(this).attr("data-for"))}),$("#features-select").change(function(){load_feature_files_select()}),$("#reqlogin").change(function(){this.checked?($("#login-notify").show(),$("#required-login").val("true")):($("#login-notify").hide(),$("#required-login").val("false"))}),$("#set-sessions").click(function(e){e.preventDefault(),set_session_page("in")}),$("[name='reset-sessions']").click(function(e){e.preventDefault(),reset_session()}),$("#cancel-sessions").click(function(e){e.preventDefault(),cancel_session_set()}),$("#customize-settings-form").submit(function(e){e.preventDefault(),$("#customize-result").html(Theamus.Notify("spinner","Saving...")),$("#theamus-settings").scrollTop(0),$(this).find('button[type="submit"]').attr("disbaled","disabled"),$(this).append(compile_home()),Theamus.Ajax.api({type:"post",url:Theamus.base_url+"/settings/",method:["Settings","save_customization"],data:{form:this},success:function(e){$("#customize-result").show(),1===e.error.status?$("#customize-result").html(Theamus.Notify("danger",e.error.message)):($("#customize-result").html(Theamus.Notify("success","Saved.")),setTimeout(function(){$("#customize-result").html("").hide()},2e3)),$("#customize-settings-form").find('button[type="submit"]').removeAttr("disabled")}})})}function settings(){$("#config-email").change(function(){this.checked?$("#email-container").show():$("#email-container").hide(),resize_admin_window()}),$("#edit-settings-form").submit(function(e){e.preventDefault(),$("#settings-result").html(Theamus.Notify("spinner","Saving...")),$("#theamus-settings").scrollTop(0),$(this).find('button[type="submit"]').attr("disabled","disabled"),Theamus.Ajax.api({type:"post",url:Theamus.base_url+"/settings/",method:["Settings","save_settings"],data:{form:this},success:function(e){$("#settings-result").show(),1===e.error.status?$("#settings-result").html(Theamus.Notify("danger",e.error.message)):($("#settings-result").html(Theamus.Notify("success","Saved.")),setTimeout(function(){$("#customize-result").html("").hide()},2e3)),$("#edit-settings-form").find('button[type="submit"]').removeAttr("disabled")}})}),$("#update").click(function(){update_admin_window_content("theamus-settings","/settings/update-check/"),change_admin_window_title("theamus-settings","Theamus Auto Updater")})}function update_check(){$("#checker-wrapper").html(Theamus.Notify("spinner","Checking for updates...")),Theamus.Ajax.api({type:"post",url:Theamus.base_url+"/settings/",method:["Settings","get_update_info"],success:function(e){if(1===e.error.status)$("#checker-wrapper").html(Theamus.Notify("danger",e.error.message));else if(1===e.response.data.needsUpdate){var t='<button class="btn btn-primary" id="settings_update-link">Update to the latest version of Theamus</button><hr class="form-split">';$("#checker-wrapper").html('<div class="col-12">'+t+e.response.data.updateNotes+"</div>");var s=e.response.data;$("#settings_update-link").click(function(e){e.preventDefault(),$("#auto-update-result").html(Theamus.Notify("spinner","Updating...")),setTimeout(function(){Theamus.Ajax.api({type:"post",url:Theamus.base_url+"/settings/",method:["Settings","auto_update"],data:{custom:s},success:function(e){1===e.error.status?$("#auto-update-result").html(Theamus.Notify("danger",e.error.message)):($("#auto-update-result").html(Theamus.Notify("success",'Everything went smoothly.  In order for things to take effect, you need to <a id="refresh">refresh the page</a>.')),document.getElementById("refresh").addEventListener("click",function(e){e.preventDefault(),update_admin_window_content("theamus-settings","/settings/"),change_admin_window_title("theamus-settings","Theamus Settings"),window.location.reload(!0)}))}})},10)})}else $("#checker-wrapper").html(Theamus.Notify("info","No updates are available."))}})}function settings_manual_update(){$("#settings_update-form").submit(function(e){e.preventDefault(),$("#settings_update-result").show().html(Theamus.Notify("spinner","Updating...")),$("#theamus-settings").scrollTop(0),$(this).find('button[type="submit"]').attr("disabled","disabled"),Theamus.Ajax.api({type:"post",url:Theamus.base_url+"/settings/",method:["Settings","manual_update"],data:{form:this},success:function(e){$("#settings_update-result").html(1===e.error.status?Theamus.Notify("danger",e.error.message):Theamus.Notify("success",'Everything went smoothly.  In order for things to take effect, you need to <a href="./">refresh the page</a>.')),$("#settings_update-form").find('button[type="submit"]').removeAttr("disabled")}})})}function test_email_listener(){$("#settings_test-email-button").on("click",function(){$("#settings_test-email-result").show().html(Theamus.Notify("spinner","Sending test email...")),setTimeout(function(){Theamus.Ajax.api({type:"post",url:Theamus.base_url+"/settings/",method:["Settings","test_email"],data:{custom:{host:$("#host").val(),protocol:$("#protocol").val(),port:$("#port").val(),email:$("#email").val(),password:$("#password").val(),to:$("#settings_test-email").val()}},success:function(e){1===e.error.status?($("#settings_test-email-result").html(Theamus.Notify("danger",e.error.message.replace(/(<([^>]+)>)/gi,""))),setTimeout(function(){$("#settings_test-email-result").html("").hide()},1500)):($("#settings_test-email-result").html(Theamus.Notify("success","Email sent successfully.")),setTimeout(function(){$("#settings_test-email-result").html("").hide()},5e3))}})},100)})}