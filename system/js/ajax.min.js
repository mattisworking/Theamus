var ajax=new function(){this.fail=!1,this.has_file=!1,this.hideable=!1,this.allow_file_upload=!0,this.run=function(t){this.allow_file_upload=!0;var e,a;return e=this.get_form_data(t),e=this.get_extra_fields(t,e),e=this.add_ajax_type(t,e),e=this.add_file_object(t,e),e=this.get_ajax_hash(e),e=this.get_location(e),a=this.sanitize_url(t),this.fail===!1?$.ajax({type:"POST",url:a,data:e,processData:this.processData,contentType:this.contentType,xhr:function(){var e=new XMLHttpRequest;return void 0!==window.FormData&&e.upload.addEventListener("progress",function(e){ajax.show_upload(e,t)},!1),e},success:function(e){ajax.hide_upload(t),ajax.show_results(t,e),ajax.run_after(t),ajax.run_return_functions(),add_extras()},error:function(t,e,a){console.log("AJAX Error: "+a)}}):console.log("AJAX Setup Error: "+this.fail),!1},this.get_form_data=function(t){var e,a,i,s;return"form"in t?(e=$("#"+t.form),e.length>0?(a=this.get_form_elements(t.form),i=this.get_element_values(a),s=this.make_form_data(i)):s=this.form_data()):s=this.form_data(),s},this.form_data=function(){if(void 0===window.FormData)return this.processData=!0,this.contentType="application/x-www-form-urlencoded",{};var t=new FormData;return this.processData=!1,this.contentType=!1,t},this.form_data_append=function(t,e,a){return void 0===window.FormData?t[e]=a:t.append(e,a),t},this.get_form_elements=function(t){var e="object"==typeof t?$(t).find(":input"):$("#"+t+" :input");return e},this.reset_form_elements=function(t,e){var a=this.get_form_elements(t);e=void 0!==e?e:new Array;for(var i=0;i<a.length;i++)-1===e.indexOf(a[i].name)&&"button"!==a[i].type&&"submit"!==a[i].type&&(a[i].value="")},this.get_id_elements=function(t){for(var e=new Array,a=0;a<t.length;a++)e.push($("#"+t[a])[0]);return e},this.get_element_values=function(t,e){var a,i,s;a=new Array,(void 0===e||null===e)&&(e=!1);for(var o=0;o<t.length;o++){if(i=t[o],void 0===i||null===i){this.fail="Failed to gather an element.";break}if("checkbox"===i.type)s=i.checked===!0?"true":"false";else if("file"===i.type&&void 0!==window.FormData)i.files.length>0&&this.allow_file_upload===!0&&i.files.length>=1?(s=i.files[0],this.has_file=!0):(s="false",this.has_file=!1);else if("radio"===i.type){for(var n=$("[name='"+i.name+"']"),r=0;r<n.length;r++)if(n[r].checked){s=n[r].value;break}}else if("select"===i.tagName.toLowerCase())if("multiple"===i.getAttribute("multiple")){var l,d;l=i.options,d=new Array;for(var u=0;u<l.length;u++)l[u].selected===!0&&d.push(l[u].value);s=d.join(",")}else s=i.value;else s="div"===i.tagName.toLowerCase()?i.innerHTML:i.value;e===!1?void 0===i.name?a[i.id]=s:a[i.name]=s:a.push(s)}return a},this.make_form_data=function(t,e){(void 0===e||null===e)&&(e=this.form_data());var a;for(key in t)a="object"==typeof t[key]?t[key]:encodeURIComponent(t[key]),e=this.form_data_append(e,key,a);return e},this.get_extra_fields=function(t,e){var a,i,s;return"extra_fields"in t?(a=t.extra_fields,$.isArray(a)===!1&&(a=new Array,a.push(t.extra_fields)),i=this.get_id_elements(a),s=this.get_element_values(i),e=this.make_form_data(s,e)):e},this.format_bytes=function(t){var e=Math.floor(Math.log(t)/Math.log(1024));return 1*(t/Math.pow(1024,e)).toFixed(2)+" "+["B","kB","MB","GB","TB"][e]},this.get_ajax_hash=function(t){var e=!1;void 0===t&&(e=!0);var a=document.getElementById("ajax-hash-data");return void 0!==a?e===!0?a.value:t=this.form_data_append(t,"ajax-hash-data",a.value):void(e===!0?this.api_fail="Unable to make AJAX request.":this.fail="Unable to make AJAX request.")},this.get_location=function(t){return t=0!==$(".admin").length&&$(".admin").hasClass("admin-panel-open")?this.form_data_append(t,"location","admin"):this.form_data_append(t,"location","site")},this.sanitize_url=function(t){var e,a;return"url"in t?("/"!==t.url.slice(-1),e="",a=t.url+e):void(this.fail="There is no URL to go to.")},this.add_ajax_type=function(t,e){var a="type"in t?t.type:"script";return e=this.form_data_append(e,"ajax",a)},this.get_result_area=function(t){if("result"in t){if("string"!=typeof t.result)return $(t.result);if($("#"+t.result).length>0)return $("#"+t.result);this.fail="The AJAX result div provided doesn't exist."}else this.fail="There is nowhere to put the AJAX results."},this.show_upload=function(t,e){var a,i,s="upload-progress",o="upload-percentage",n=5,r=!0;if("upload"in e&&(s="growbar"in e.upload?e.upload.growbar:s,o="percentage"in e.upload?e.upload.percentage:o,n="stop"in e.upload?e.upload.stop:n,r="show"in e.upload?e.upload.show:r),$("#"+s).length<1&&(r=!1),$("#"+o).length<1&&(i=!1),t.lengthComputable){$("#"+s).length>0&&"block"!==$("#"+s)[0].style.display&&$("#"+s).show();var l=ajax.get_upload_data(t);return a=l.completed,r===!0&&this.has_file!==!1&&($("#"+s).show(),$("#"+s)[0].style.width=a*n+"px",i!==!1&&$("#"+o).html(a+"%"),this.hideable=!0,this.stop=n),a}},this.get_upload_data=function(t){var e=0;t.lengthComputable&&(e=Math.floor(t.loaded/t.total*100));var a={percent_completed:e,percentage:e+"%",loaded:t.loaded,loaded_formatted:this.format_bytes(t.loaded),total_bytes:t.total,total_bytes_formatted:this.format_bytes(t.total),time_micro:t.timeStamp,time_formatted:new Date(t.timeStamp)};return a},this.hide_upload=function(t){if(this.hideable===!0&&"upload"in t){var e="hide"in t.upload?t.upload.hide:!0,a="hide_time"in t.upload?t.upload.hide_time:3;a=1e3*a;var i="growbar"in t.upload?t.upload.growbar:"upload-progress",s="percentage"in t.upload?t.upload.percentage:"upload-percentage";$("#"+i)[0].style.width=100*this.stop+"px",$("#"+s).html("100%"),e===!0&&setTimeout(function(){$("#"+i).hide()},a)}},this.run_after=function(t){var e,a;if("after"in t)if("function"==typeof t.after)t.after();else if("do_function"in t.after)if(e=t.after.do_function,"string"==typeof e)a="arguments"in t.after?t.after.arguments:"",window[e](a);else for(var i=0;i<e.length;i++)a="arguments"in t.after?t.after.arguments[i]:"",window[e[i]](a)},this.run_return_functions=function(){var t,e,a=$("[name='run_after']");if(a.length>0)for(var i=0;i<a.length;i++)t=a[i].getAttribute("function"),e=a[i].getAttribute("arguments"),""!==e&&(e=$.parseJSON(e)),window[t](e),a[i].remove()},this.show_results=function(t,e){var a=this.get_result_area(t);void 0!==a?(a.show(),a.html(e),"hide_result"in t&&setTimeout(function(){a.hide()},1e3*t.hide_result)):console.log(this.fail)},this.add_file_object=function(t,e){return"file_object"in t&&(e=this.form_data_append(e,"file",t.file_object),this.has_file=!0),e},this.api=function(t){api_return=!1,this.allow_file_upload=!0,this.api_fail=!1;var e=this.check_api_args(t);return e.url=this.sanitize_url(e),e.data=this.make_api_data(e),e.form_data="post"===e.type?this.make_form_data(e.data):e.data,void 0!==t.upload&&void 0!==t.upload.files&&(e.form_data=this.form_data_append(e.form_data,"upload_file",t.upload.files[0]),this.has_file=!0),"get"===e.type&&(this.processData=!0,this.contentType="application/x-www-form-urlencoded; charset=UTF-8"),this.api_fail=this.api_fail_response(),this.api_fail!==!1&&("function"!=typeof e.success?console.log("Theamus API error: "+this.api_fail.error.message):e.success(this.api_fail)),this.api_fail===!1&&$.ajax({async:this.has_file?!0:!1,type:e.type,url:e.url,data:e.form_data,processData:this.processData,contentType:this.contentType,xhr:function(){var e=new XMLHttpRequest;return void 0!==window.FormData&&e.upload.addEventListener("progress",function(e){"upload"in t&&"during"in t.upload&&"function"==typeof t.upload.during&&t.upload.during(ajax.get_upload_data(e))},!1),e},success:function(t,a,i){try{var t=JSON.parse(t);t.response.headers=i.getAllResponseHeaders(),t.response.text=a,t.response.status=i.status}catch(s){var t={error:{status:1,message:"Failed to decode API return data."},response:{headers:i.getAllResponseHeaders,text:a,status:i.status,data:t}}}api_return=e.success(t)}}),api_return},this.check_api_args=function(t){var e={ajax:"api",hash:this.get_ajax_hash()};return"object"!=typeof t?(this.api_fail="API arguments are not valid.",t={url:"",method:""}):("type"in t&&"string"==typeof t.type?("post"!==t.type&&"get"!==t.type?this.api_fail="API request type must be 'post' or 'get'.":e.type=t.type.toLowerCase(),"get"===t.type&&(this.allow_file_upload=!1)):this.api_fail="Invalid API request type.","url"in t&&"string"==typeof t.url?e.url=t.url:this.api_fail="Invalid API url.","method"in t?(e.method_class="","string"==typeof t.method?e.method=t.method:"object"==typeof t.method?(t.method.length>=1?e.method_class=t.method[0]:this.api_fail="Undefined API method.",t.method.length>=2?e.method=t.method[1]:this.api_fail="Undefined API method after finding class."):this.api_fail="Invalid API method defined."):this.api_fail="API method not defined.","data"in t&&("form"in t.data&&("object"==typeof t.data.form?e.data_form=t.data.form:this.api_fail="Invalid API form selector."),"custom"in t.data&&("object"==typeof t.data.custom?e.data_custom=t.data.custom:this.api_fail="Invalid API custom data type."),"elements"in t.data&&("object"==typeof t.data.elements?e.data_elements=t.data.elements:this.api_fail="Invalid API elements data type.")),"success"in t?"function"==typeof t.success?e.success=t.success:this.api_fail="API success must be a function.":this.api_fail="Undefined 'success' function to run.",e)},this.api_fail_response=function(){return this.api_fail!==!1?{error:{status:1,message:this.api_fail},response:{status:0,data:"",text:""}}:!1},this.make_api_data=function(t){var e={method_class:t.method_class,method:t.method,ajax:t.ajax,"ajax-hash-data":t.hash,"api-from":"javascript"},a=this.get_form_elements(t.data_form),i=this.get_element_values(a);for(var s in i)e[s]=i[s];for(var s in t.data_custom){if(void 0!==e[s]){this.api_fail="Multiple data key detected. Conflicted key = '"+s+"'.";break}e[s]=t.data_custom[s]}if(void 0!==t.data_elements)for(var o=0;o<t.data_elements.length;o++){if(t.data_elements[o].length>1){this.api_fail="Multiple custom elements detected where there should be one.";break}var n=$(t.data_elements[o]),s="";if(void 0!==n.attr("id")&&(s=n.attr("id")),""===s&&void 0!==n.attr("name")&&(s=n.attr("name")),""===s){this.api_fail="Element has no identifiable name or id.";break}void 0!==e[s]?this.api_fail="Multiple data key detected.  Conflicted key = '"+s+"'.":e[s]=this.get_element_values(t.data_elements[o],!0)[0]}return e},this.iterate_calls=function(t,e,a){var i=e,e=void 0!==e?1e3*parseFloat(e):0,a=void 0!==a?a:0,s=function(){};return void 0===t?void console.log("Iterate calls error: Functions not defined."):void(void 0!==t[a]&&setTimeout(function(){s="function"==typeof t[a]?t[a]:window[t[a]],s()!==!1&&ajax.iterate_calls(t,i,a+1)},e))}};